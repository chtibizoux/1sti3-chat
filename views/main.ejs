<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <meta name="description" content="A chat app for my classmates.">
    <meta name="author" content="Clément Songis">
    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#36393f">
    <title>Chat - 1ère STI2D 3</title>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <div class="content">
        <section class="links-section">
            <a href="https://discord.gg/5dhCw47aWT" style="background-color: #5865f2;">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 512">
                    <path fill="currentColor"
                        d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z">
                    </path>
                </svg>
            </a>
            <a href="https://github.com/chtibizoux/1sti3-chat" style="background-color: #161b22;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
                    <path fill="currentColor"
                        d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                    </path>
                </svg>
            </a>
        </section>
        <% (function () {
        var autoLink, slice = [].slice;
        autoLink = function () {
            var callback, k, linkAttributes, option, options, pattern, v;
            options = 1 <= arguments.length ? slice.call(arguments, 0) : [];
            pattern = /(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi;
            if (!(options.length > 0)) {
                return this.replace(pattern, "$1<a href='$2'>$2</a>");
            }
            option = options[0];
            callback = option["callback"];
            linkAttributes = ((function () {
                var results;
                results = [];
                for (k in option) {
                    v = option[k];
                    if (k !== 'callback') {
                        results.push(" " + k + "='" + v + "'");
                    }
                }
                return results;
            })()).join('');
            return this.replace(pattern, function (match, space, url) {
                var link;
                link = (typeof callback === "function" ? callback(url) : void 0) || ("<a href='" + url + "'" + linkAttributes + ">" + url + "</a>");
                return "" + space + link;
            });
        };
        String.prototype['autoLink'] = autoLink;
        var format = function () {
            return this.autoLink({
                callback: function (url) {
                    return /\.(webp|svg|gif|png|jpe?g)$/i.test(url) ? '<a href="' + url + '"><img src="' + url + '"></a>' : null;
                }
            })
                .replace(/```(.*\n)?([^```][^```]*)```/g, "<pre><code>$2</code></pre>")
                .replace(/`([^`][^`]*)`/g, "<code>$1</code>")
                .replace(/\n/g, "<br>")
                .replace(/~~([^~~][^~~]*)~~/g, "<s>$1</s>")
                .replace(/<@!?&?([0-9]{18})>/g, "<span class='mention'>@$1</span>")
                .replace("@everyone", "<span class='mention'>@everyone</span>")
                .replace("@here", "<span class='mention'>@here</span>")
                .replace(/<#([0-9]{18})>/g, "<span class='mention'>#$1</span>")
                .replace(/\|\|([^\|\|][^\|\|]*)\|\|/g, "<span onclick=\"this.classList.toggle('show')\" class='spoiler'>$1</span>")
                .replace(/\*\*([^\*\*][^\*\*]*)\*\*/g, "<strong>$1</strong>")
                .replace(/__([^__][^__]*)__/g, "<u>$1</u>")
                .replace(/[\*_]([^\*_][^\*_]*)[\*_]/g, "<em>$1</em>");
        }
        String.prototype['discordFormat'] = format;
    }).call(this); %>
        <section class="messages-section" id="msgs">
            <% if (connected) { %>
            <% for (const message of messages) { %>
            <% var file = message.file ? (/\.(webp|svg|gif|png|jpe?g)$/i.test(message.file) ? `<a href="${encodeURI(message.file)}"><img src="${encodeURI(message.file)}"></a>` : `<a href="${encodeURI(message.file)}">${decodeURI(message.file).slice(message.file.lastIndexOf("/") + 1)}</a>`) : ""; %>
            <div>
                <img src="<%= message.author.avatar %>">
                <h2><%= message.author.name %> <span><%= message.date %><%= message.discord ? " DISCORD" : "" %></span>
                </h2>
                <p><%- message.text.discordFormat() %></p>
                <%- file %>
            </div>
            <% } %>
            <% } %>
        </section>
        <section class="users-section">
            <h2>
                Utilisateurs
            </h2>
            <div id="users">
                <% if (connected) { %>
                <% for (const id in users) { %>
                <div id="<%= users[id].id %>">
                    <img src="<%= users[id].avatar %>">
                    <span><%= users[id].name %></span>
                </div>
                <% } %>
                <% } %>
            </div>
            <h3>
                Serveur Discord
            </h3>
            <div id="discord-users">
                <% if (connected) { %>
                <% for (const user of discordUsers) { %>
                <div id="<%= user.id %>">
                    <img
                        src="<%= user.avatar || "https://cdn.glitch.global/b05fb1d4-94c5-48f2-a2dc-ec7b07cec5bb/c09a43a372ba81e3018c3151d4ed4773.png?v=1643911673841" %>">
                    <span><%= user.name %></span>
                </div>
                <% } %>
                <% } %>
            </div>
        </section>
        <section class="send-section">
            <div id="file-upload" style="display: none;">
                <span id="upload-name"></span>
                <progress id="upload-progress" value="20" max="100"></progress>
            </div>
            <div id="file-to-upload" onclick="remove()" style="display: none;">
                <span id="file-name"></span>
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 320 512">
                    <path fill="currentColor"
                        d="M207.6 256l107.72-107.72c6.23-6.23 6.23-16.34 0-22.58l-25.03-25.03c-6.23-6.23-16.34-6.23-22.58 0L160 208.4 52.28 100.68c-6.23-6.23-16.34-6.23-22.58 0L4.68 125.7c-6.23 6.23-6.23 16.34 0 22.58L112.4 256 4.68 363.72c-6.23 6.23-6.23 16.34 0 22.58l25.03 25.03c6.23 6.23 16.34 6.23 22.58 0L160 303.6l107.72 107.72c6.23 6.23 16.34 6.23 22.58 0l25.03-25.03c6.23-6.23 6.23-16.34 0-22.58L207.6 256z">
                    </path>
                </svg>
            </div>
            <div class="send-form">
                <div contenteditable="true" id="message-input" onkeyup="message(event)"></div>
                <button type="button" onclick="document.getElementById('file').click();">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512">
                        <path fill="currentColor"
                            d="M384 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm120 16c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-48 0c0-110.5-89.5-200-200-200S56 145.5 56 256s89.5 200 200 200 200-89.5 200-200z">
                        </path>
                    </svg>
                </button>
            </div>
        </section>
        <button type="button" onclick="show()" id="users-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 512">
                <path fill="currentColor"
                    d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z">
                </path>
            </svg>
        </button>
        <section id="login" class="login-section" <% if (connected) { %> style="transform: translateX(-100%);" <% } %>>
            <form onsubmit="login(event)" id="login-form">
                <p class="error"></p>
                <h5>Nom d'utilisateur</h5>
                <input id="username-input" type="text">
                <h5>Mot de passe</h5>
                <input id="password-input" type="password">
                <br>
                <button type="submit">
                    Se connecter
                </button>
            </form>
            <form onsubmit="register(event)" id="register-form" style="display: none;">
                <div type="button" onclick="document.getElementById('avatar-file').click();" class="avatar-button">
                    <img src="/images/user.png" alt="Avatar" id="avatar">
                </div>
                <progress id="avatar-upload-progress" value="20" max="100" style="display: none;"></progress>
                <p class="error"></p>
                <h5>Nom d'utilisateur</h5>
                <input id="register-username-input" type="text">
                <h5>Mot de passe</h5>
                <input id="register-password-input" onkeyup="checkPassword()" type="password">
                <h5>Confirme ton mot de passe</h5>
                <input id="register-password2-input" onkeyup="checkPassword()" type="password">
                <br>
                <button type="submit" id="submit">
                    S'inscrire
                </button>
                <p>
                    Déja un compte ?
                    <span
                        onclick="document.getElementById('register-form').style.display = 'none';document.getElementById('login-form').style.display = '';document.getElementById('login-other').style.display = '';">
                        Se connecter
                    </span>
                </p>
            </form>
            <div id="login-other">
                <button onclick="document.location.href = '/login';">
                    Se connecter avec Discord
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 512">
                        <path fill="currentColor"
                            d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z">
                        </path>
                    </svg>
                </button>
                <button
                    onclick="document.getElementById('register-form').style.display = '';document.getElementById('login-form').style.display = 'none';document.getElementById('login-other').style.display = 'none';">
                    S'inscrire
                </button>
            </div>
        </section>
        <div id="drag-zone" style="display: none;">
            <input type="file" <% if (connected) { %> style="display: none;" <% } %> accept="image/*" id="avatar-file"
                onchange="avatarUploaded()">
            <input type="file" <% if (!connected) { %> style="display: none;" <% } %> id="file" onchange="uploaded()">
            Drag file here
        </div>
        <script src="js/main.js"></script>
    </div>
</body>

</html>